# DPC練習用ゲーム 仕様書

## シーン

### Titleシーン

- **UI**
    - **GameStartボタン**
        - ボタンをクリックすると`SelectMode`シーンに遷移する。
    - **遊び方/設定ボタン**
        - 操作方法の確認や、キーコンフィグ（回転、移動、ホールド等）を行う画面へ遷移する。

### SelectModeシーン

- **UI**
    - **DPC練習モード選択**
        - **S/Zミノ残し**
            - **ライムDPC (S/ZがOより早い)**
                - 4巡目のミノキューにおいて、SミノとZミノがOミノより先に出現するパターン。
            - **くるまDPC (S/ZがOより遅い)**
                - 4巡目のミノキューにおいて、OミノがSミノとZミノより先に出現するパターン。
            - **ランダム**
                - 上記2パターンをランダムで出題する。
    - **シーン遷移**
        - 各モードを選択すると、**`PracticeScene`** (Gameシーンの名称案) に遷移し、対応するミノ順の状態でセットアップする。
    - **タイトルに戻るボタン**
        - `Title`シーンに戻る。

### PracticeScene
---
#### ゲームプレイ基本仕様 (Guideline準拠)
このシーンにおけるテトリミノの挙動は、「2009 Tetris Design Guideline」に準拠した、実際のテトリスと全く同じゲームロジックを実装する。

最低限、以下の仕様をガイドラインに基づいて実装する必要があります。

- **フィールド (Matrix):**
    - 標準の10 (幅) x 20 (高さ) のプレイ領域とする
- **テトリミノ生成 (Generation):**
    - 7種類のテトリミノを1セットとする「**Bag System**」（通称「7種1巡」）を実装
- **回転 (Rotation):**
    - 「**Super Rotation System (SRS)**」を実装する
    - 詳細はガイドラインのAppendix A1.4を参照
- **左右移動 (Horizontal Movement):**
    - キーを押し続けた際の自動リピート（Auto-Repeat）を実装
    - リピート開始までの遅延（DAS: 約0.3秒）と、リピート速度（ARR）をガイドラインSection 5.2に基づき設定
- **ハードドロップ (Hard Drop):**
    - 実行すると即座に（0.0001秒で）テトリミノが落下し、**即時ロックダウン**する仕様を実装する
- **設置判定 (Lock Down):**
    - デフォルトの「**Extended Placement Lock Down**」を実装
    - テトリミノが床や他のブロックに接地（land）すると、0.5秒の**Lock Down Timer**が開始する
    - タイマーが切れる前に移動または回転を行うと、タイマーはリセットされる
    - ただし、移動・回転の**回数が15回**に達すると、タイマーはリセットされず即時ロックダウンする
- **ホールド (Hold):**
    - ホールド機能を実装
    - テトリミノを**ロックダウンさせるまでの間、ホールドは1回のみ**使用可能とする
---

#### DPC練習モードのロジック
このシーンは「3巡目8ラインPCが完了した直後」の状態からスタートする

1.  **初期セットアップ**
    - `SelectMode`シーンでの選択に基づき、ミノのキューを生成する。
    - **フィールド:** 0段の空の状態で開始する。
    - **ホールド:** 3巡目残しのSミノまたはZミノのどちらか1つをランダムで自動セットする。
    - **ミノキュー (Next Queue):**
        - **1番目:** ホールドされなかった方の3巡目残しのミノ（SまたはZ）。
        - **2番目〜8番目:** 4巡目のミノ7個（T, I, O, L, J, S, Z）を、`SelectMode`で選択したパターン（ライム/くるま）に基づいて並べたもの。
    - ガイドラインに基づき、Next Queueは理想的には6個先まで表示

2.  **フェーズ1: TSD構築**
    - プレイヤーはセットアップされたミノ（ホールド内の1個 + キュー内の7個、合計8個）を使い、DPCのTSD形を組む。
    - 4巡目のTミノでT-Spin Doubleを撃った時点で、フェーズ2に移行する。

3.  **フェーズ2: 5巡目PC**
    - TSDが成功すると、5巡目のミノ（T, I, O, L, J, S, Z）がランダムな順序（Bag Systemに従う）でキューにセットされる。
    - プレイヤーはこれらのミノを使い、パーフェクトクリア（全消し）を目指す。

4.  **判定**
    - **成功 (Success):**
        - フェーズ2で5巡目のミノをすべて使い切り、フィールドが空（パーフェクトクリア）になった場合。
    - **失敗 (Failed):**
        - フェーズ1でTSDを撃つ前に、Tミノ以外のミノでラインを消去してしまった場合。
        - フェーズ1でTSD以外のT-Spin（SingleやTriple）を撃った場合。
        - フェーズ2で、5巡目のミノを使い切る前に地形が最上段に達した場合（ゲームオーバー）。
        - フェーズ2で、5巡目のミノをすべて使い切った時点でフィールドにブロックが残っていた場合。

#### UI

- **フィールド (プレイ領域)**
- **ネクスト (Next Queue)**
    * 次のミノを**6個**先まで表示する。
- **ホールド (Hold)**
    * ホールド中のミノを表示するUI領域。
- **（追加）ゴーストピース (Ghost Piece)**
    * テトリミノの落下地点を示すゴーストピースを常時表示する。
- **一時停止ボタン**
    - クリックで`一時停止メニュー`をオーバーレイ表示し、ゲームを停止する。
- **一時停止メニュー (UI)**
    - **リトライボタン**
        - 現在のミノ順（シード値）を維持したまま、`PracticeScene`の最初（フェーズ1）からやり直す。
    - **モード選択に戻るボタン**
        - `SelectMode`シーンに戻る。
    - **ゲームに戻るボタン**
        - 一時停止を解除し、ゲームを再開する。
- **ステータス表示 (UI)**
    - 現在のフェーズ（例: `Phase 1: Build TSD`、`Phase 2: Go for PC!`）や、結果（`Success! Perfect Clear!`、`Failed...`）を表示するテキストエリア。
- **（追加）リセットボタン**
    - **（リトライとは別）** 新しいミノ順（新しいシード値）で、現在のモード（例: ライムDPC）を最初からやり直す。